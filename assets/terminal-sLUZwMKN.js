const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./pdfViewer-DvVElbgt.js","./index-bPVaF8Ld.js","./index-BLk5d-SX.css","./articleViewer-CEjeh5Ow.js","./galleryViewer-Abu9FELN.js","./circuitViewer-DawS3EO4.js","./OrbitControls-hv_4xcvx.js","./softwareVisualizer-DJ5s2Tm6.js"])))=>i.map(i=>d[i]);
import{m as X,a as O,n as J,_ as v}from"./index-bPVaF8Ld.js";const U="guest@desktop-micha MINGW64";function it(){const o=document.createElement("div");o.className="terminal-shell",o.innerHTML=`
    <div class="terminal-header"></div>
    <div class="terminal-output" aria-live="polite"></div>
    <input class="terminal-input-hidden" aria-label="Terminal input" />
  `;const u=o.querySelector(".terminal-output"),d=o.querySelector(".terminal-input-hidden"),y=o.querySelector(".terminal-header");let p="",m=null,l=null,h="/",T=null;function I(t){return t?(t.startsWith("/")||(t="/"+t),t=t.replace(/\/+/g,"/"),t==="/."&&(t="/"),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t):"/"}function A(){return h==="/"?"~":h}function E(){return`${U} ${A()} (main)`}function n(t=""){const e=document.createElement("div");e.textContent=t,u.appendChild(e),u.scrollTop=u.scrollHeight}function c(){m&&m.remove(),m=document.createElement("div"),m.innerHTML=`<span class="terminal-prompt">${E()}</span> $ <span class="terminal-buffer">${p}</span>`,u.appendChild(m),u.scrollTop=u.scrollHeight,y.textContent=E()}function F(t){const e=t;m&&(m.innerHTML=`<span class="terminal-prompt">${E()}</span> $ ${e}`,m=null),B(e.trim())}o.addEventListener("click",()=>d.focus());function R(){var V,b;const t=["help","ls","cd","cat","yes","strfry","fortune"],e=L(p),r=/\s$/.test(p);if(e.length===0){n(t.join("  ")),n(""),c();return}const s=e.length===1&&!r;let i=r?"":e[e.length-1];if(s){const f=t.filter(_=>_.startsWith(i));f.length===1?(p=f[0]+" ",c()):f.length>1&&(n(f.join("  ")),n(""),c());return}const a=r?"":i;let w=h,D=a;const W=a.lastIndexOf("/");W>=0&&(w=a.slice(0,W)||"/",D=a.slice(W+1));const{node:g}=k(w||"/"),P=M(g).map(f=>f.endsWith("/")?f.slice(0,-1):f).filter(f=>f.startsWith(D));if(P.length===1){const f=P[0],_=(w&&w!=="/"?w+"/":"")+f,K=/\s/.test(_)?`"${_}"`:_,x=[...e];r||x.pop(),x.push(K);const C=((V=g==null?void 0:g.children)==null?void 0:V[f])||((b=g==null?void 0:g.children)==null?void 0:b[`${f}/`])||null;p=x.join(" ")+((C==null?void 0:C.type)==="folder"?"/":" "),c()}else P.length>1&&(n(P.join("  ")),n(""),c())}function $(){l&&typeof l.stop=="function"&&l.stop(),l=null}function L(t){const e=[];let r="",s=null;for(let i=0;i<t.length;i++){const a=t[i];if(a==='"'||a==="'"){s===a?s=null:s?r+=a:s=a;continue}if(!s&&(a===" "||a==="	")){r.length&&(e.push(r),r="");continue}r+=a}return r.length&&e.push(r),e}async function B(t){if(!t){p="",c();return}const[e,...r]=L(t),i={help:S,yes:Q,ls:N,cat:H,strfry:q,fortune:z,cd:G}[e];i?await i(r):n(`${e}: command not found`),p="",c()}function S(){n("Available commands:"),n("  help                   - show this help"),n("  ls [path]              - list directories (simple view)"),n("  cd <path>              - change directory (limited virtual dirs)"),n("  cat <path>             - print file contents"),n("  yes                    - print y repeatedly (Ctrl+C to stop)"),n("  strfry <word>          - shuffle letters"),n("  fortune                - print a random fortune"),n("")}function k(t){var a;let e=t;e==null||e===""||e==="."?e=h:e==="~"&&(e="/");const r=e.startsWith("/")?I(e):I(`${h}/${e}`),s=r.split("/").filter(Boolean);let i=j();for(const w of s){if(!i||i.type!=="folder"||!((a=i.children)!=null&&a[w]))return{node:null,full:r};i=i.children[w]}return{node:i,full:r}}function M(t){return!t||t.type!=="folder"?[]:Object.entries(t.children||{}).map(([e,r])=>r.type==="folder"?`${e}/`:e)}function N(t){const e=t[0]?t[0]:".",{node:r,full:s}=k(e);if(!r||r.type!=="folder")n(`ls: cannot access '${e}': No such file or directory`);else{const i=M(r);n(i.join("  "))}n("")}async function H(t){if(!t.length){n("cat: missing file operand"),n("");return}const e=t[0],{node:r,full:s}=k(e);if(!r){n(`cat: ${e}: No such file or directory`),n("");return}if(r.type==="folder"){n(`cat: ${e}: Is a directory`),n("");return}et(r,s),n("")}function q(t){if(!t.length){n("strfry: missing operand"),n("");return}const r=t[0].split("");for(let s=r.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[r[s],r[i]]=[r[i],r[s]]}n(r.join("")),n("")}async function z(){try{const t=await fetch(O("documents/fortunes.txt"));if(!t.ok)throw new Error("missing fortune file");const r=(await t.text()).split("%").map(i=>i.trim()).filter(Boolean);if(!r.length)throw new Error("no fortunes");const s=r[Math.floor(Math.random()*r.length)];n(s)}catch{n("fortune: could not load fortunes")}n("")}function G(t){const e=t[0];if(!e||e==="~"){h="/",n(""),c();return}if(e===".."){if(h!=="/"){const i=h.split("/").filter(Boolean);i.pop(),h=i.length?"/"+i.join("/"):"/"}n(""),c();return}const{node:r,full:s}=k(e);r&&r.type==="folder"?(h=s,n("")):(n(`cd: no such file or directory: ${e}`),n("")),c()}function Q(){$();let t=0;const e=setInterval(()=>{n("y"),t+=1,t>=100&&$()},10);l={stop:()=>{clearInterval(e),l=null}}}return d.addEventListener("keydown",t=>{if(t.key==="c"&&t.ctrlKey){t.preventDefault(),n("^C"),$(),p="",c();return}if(t.key==="Tab"){t.preventDefault(),R();return}if(t.key==="Enter"){t.preventDefault(),F(p);return}if(t.key==="Backspace"){t.preventDefault(),p=p.slice(0,-1),c();return}if(t.key.length===1){t.preventDefault(),p+=t.key,c();return}}),n("Welcome to mwaOS shell."),n("Type commands and press Enter."),n(""),Y().then(t=>{T=t||j()}).finally(()=>{T=T||j(),c(),d.focus()}),X({title:"Terminal",body:o,width:720,height:420,icon:`<svg viewBox="0 0 32 32" class="w-8 h-8">
      <rect x="2" y="4" width="28" height="24" rx="3" fill="#0f172a" stroke="#8ec8ff" stroke-width="2"/>
      <path d="M8 10l5 6-5 6" stroke="#7ed957" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M16 22h7" stroke="#8ec8ff" stroke-width="2" stroke-linecap="round"/>
    </svg>`})}async function Y(){try{const o=await fetch(O("content/items.json"));if(!o.ok)throw new Error("fs load failed");const u=await o.json();J(u);const d={type:"folder",children:u};return window.__mwaFsTree=d,d}catch(o){return console.error("terminal fs load error",o),null}}function j(){return window.__mwaFsTree||fsTree||{type:"folder",children:{}}}function Z(o){return o&&o.type&&o.type!=="folder"}function tt(o,u){const d=window.wm;if(!d)return;const y=u.split("/").filter(Boolean).pop()||"File",m={pdf:async()=>{const l=await v(()=>import("./pdfViewer-DvVElbgt.js"),__vite__mapDeps([0,1,2]),import.meta.url);d.openWindow(l.createPdfViewer({title:y,src:o.src}))},text:async()=>{const l=await v(()=>import("./articleViewer-CEjeh5Ow.js"),__vite__mapDeps([3,1,2]),import.meta.url);d.openWindow(l.createArticleViewer({title:y,content:o.content,images:o.images||[]}))},gallery:async()=>{const l=await v(()=>import("./galleryViewer-Abu9FELN.js"),__vite__mapDeps([4,1,2]),import.meta.url);d.openWindow(l.createGalleryViewer({title:y,imagePath:o.imagePath}))},hardware:async()=>{const l=await v(()=>import("./circuitViewer-DawS3EO4.js"),__vite__mapDeps([5,1,2,6]),import.meta.url);d.openWindow(l.createCircuitViewer({title:y,graph:o.graph}))},software:async()=>{const l=await v(()=>import("./softwareVisualizer-DJ5s2Tm6.js"),__vite__mapDeps([7,1,2,6]),import.meta.url);d.openWindow(l.createSoftwareVisualizer({title:y,graph:o.graph}))},links:async()=>{var l,h;(h=(l=o.links)==null?void 0:l[0])!=null&&h.href&&window.open(o.links[0].href,"_blank")}}[o.type];m?m():o.src&&window.open(o.src,"_blank")}function et(o,u){Z(o)&&tt(o,u)}export{it as createTerminal};
