import{m as K}from"./index-bPVaF8Ld.js";import{S as Q,C as _,P as ee,W as te,O as oe,A as ne,D as se,B as x,M as u,a as d,b as ae,c as O,d as I,e as ie,f as re,g as ce,L as le,V as M,h as de,i as he,R as pe,j as me}from"./OrbitControls-hv_4xcvx.js";function ue(f){var G,L,k,z;const h=document.createElement("div");h.className="w-full h-full bg-[#0e1626] relative";const p=document.createElement("div");p.className="tooltip hidden",h.appendChild(p);const C=document.createElement("div");C.className="absolute left-2 top-2 bg-white/90 text-xs p-2 rounded border",C.textContent="Drag to rotate • Scroll to zoom • Hover for details",h.appendChild(C);const j=K({title:f.title+" — 3D Schematic",body:h,width:820,height:560}),r=new Q;r.background=new _(923174);const w=new ee(60,1,.1,1e3);w.position.set(5,5,8);const m=new te({antialias:!0});m.setPixelRatio(devicePixelRatio),h.appendChild(m.domElement),new oe(w,m.domElement),r.add(new ne(16777215,.6));const P=new se(16777215,.6);P.position.set(5,10,7),r.add(P);const A=new x(12,.2,8),U=new u({color:678443}),W=new d(A,U);r.add(W);const V=new ae(11.8,7.8),g=document.createElement("canvas");g.width=256,g.height=256;const l=g.getContext("2d");l.fillStyle="#0a5a2b",l.fillRect(0,0,256,256),l.strokeStyle="#1a8a4b",l.lineWidth=1;for(let e=0;e<20;e++)l.beginPath(),l.moveTo(Math.random()*256,Math.random()*256),l.lineTo(Math.random()*256,Math.random()*256),l.stroke();const X=new O(g),F=new I({map:X,transparent:!0,opacity:.3}),v=new d(V,F);v.rotation.x=-Math.PI/2,v.position.y=.11,r.add(v);const y=(L=(G=f.graph)==null?void 0:G.nodes)!=null&&L.length?f.graph.nodes:[{id:"MCU",label:"MCU"},{id:"Sensor",label:"Sensor"},{id:"Power",label:"Power"},{id:"IO",label:"I/O"}],N=(z=(k=f.graph)==null?void 0:k.edges)!=null&&z.length?f.graph.edges:[["MCU","Sensor"],["MCU","Power"],["MCU","IO"]],R=[2236962,17578,8930304,2254370,6684774,26214],q=y.map((e,t)=>{const o=Math.ceil(Math.sqrt(y.length)),i=Math.floor(t/o),s=t%o,n=3,a=-(o-1)*n/2,c=-(Math.ceil(y.length/o)-1)*n/2;return{id:e.id,label:e.label,pos:[a+s*n,.35,c+i*n],color:R[t%R.length],type:t===0?"IC":t%3===0?"C":"R"}}),b=[];q.forEach(e=>{let t;if(e.type==="IC"){t=new d(new x(1.8,.4,1.4),new u({color:e.color}));const i=new x(.1,.2,.05),s=new u({color:8947848});for(let n=0;n<4;n++){const a=new d(i,s);a.position.set(-.6+n*.4,0,.75),t.add(a);const c=new d(i,s);c.position.set(-.6+n*.4,0,-.75),t.add(c)}}else if(e.type==="C")t=new d(new ie(.35,.35,.7,24),new u({color:e.color}));else{t=new d(new x(1,.35,.45),new u({color:e.color}));const i=new x(.12,.36,.46);[16711680,0,16766720].forEach((n,a)=>{const c=new d(i,new I({color:n}));c.position.x=-.3+a*.25,t.add(c)})}t.position.set(e.pos[0],e.pos[1],e.pos[2]),t.userData=e,b.push(t),r.add(t);const o=Y(e.label);o.position.set(e.pos[0],e.pos[1]+.8,e.pos[2]),r.add(o)});function Y(e){const t=document.createElement("canvas"),o=t.getContext("2d");o.font="bold 14px Tahoma";const i=o.measureText(e).width+12;t.width=i,t.height=20,o.font="bold 14px Tahoma",o.fillStyle="white",o.strokeStyle="black",o.lineWidth=3,o.strokeText(e,6,15),o.fillText(e,6,15);const s=new O(t),n=new re({map:s,transparent:!0}),a=new ce(n);return a.scale.set(t.width/25,t.height/25,1),a}const $=new le({color:10092441,linewidth:2});N.forEach(([e,t])=>{const o=b.find(E=>E.userData.id===e),i=b.find(E=>E.userData.id===t);if(!o||!i)return;const s=o.position,n=i.position,a=(s.x+n.x)/2,c=[new M(s.x,.12,s.z),new M(a,.12,s.z),new M(a,.12,n.z),new M(n.x,.12,n.z)],Z=new de().setFromPoints(c),J=new he(Z,$);r.add(J)});function T(){const e=h.getBoundingClientRect();m.setSize(e.width,e.height),w.aspect=e.width/e.height,w.updateProjectionMatrix()}new ResizeObserver(T).observe(h),T();const B=new pe,S=new me;function H(e){const t=m.domElement.getBoundingClientRect();S.x=(e.clientX-t.left)/t.width*2-1,S.y=-((e.clientY-t.top)/t.height)*2+1,B.setFromCamera(S,w);const o=B.intersectObjects(b)[0];o?(p.classList.remove("hidden"),p.textContent=`${o.object.userData.id} — ${o.object.userData.label}`,p.style.left=e.clientX+12+"px",p.style.top=e.clientY+12+"px"):p.classList.add("hidden")}m.domElement.addEventListener("mousemove",H);function D(){requestAnimationFrame(D),m.render(r,w)}return D(),j}export{ue as createCircuitViewer};
