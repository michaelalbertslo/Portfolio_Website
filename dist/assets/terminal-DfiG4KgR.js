const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/pdfViewer-CQKmUUk0.js","assets/index-Bjkd7MJK.js","assets/index-D4C9dhew.css","assets/articleViewer-B_uRCk4S.js","assets/galleryViewer-mokeSg_E.js","assets/circuitViewer-CjOeRHjr.js","assets/OrbitControls-hv_4xcvx.js","assets/softwareVisualizer-8YnuHtBs.js"])))=>i.map(i=>d[i]);
import{m as K,_ as v}from"./index-Bjkd7MJK.js";const X="guest@desktop-micha MINGW64";function rt(){const o=document.createElement("div");o.className="terminal-shell",o.innerHTML=`
    <div class="terminal-header"></div>
    <div class="terminal-output" aria-live="polite"></div>
    <input class="terminal-input-hidden" aria-label="Terminal input" />
  `;const h=o.querySelector(".terminal-output"),u=o.querySelector(".terminal-input-hidden"),y=o.querySelector(".terminal-header");let d="",m=null,l=null,p="/",T=null;function I(t){return t?(t.startsWith("/")||(t="/"+t),t=t.replace(/\/+/g,"/"),t==="/."&&(t="/"),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t):"/"}function O(){return p==="/"?"~":p}function P(){return`${X} ${O()} (main)`}function n(t=""){const e=document.createElement("div");e.textContent=t,h.appendChild(e),h.scrollTop=h.scrollHeight}function a(){m&&m.remove(),m=document.createElement("div"),m.innerHTML=`<span class="terminal-prompt">${P()}</span> $ <span class="terminal-buffer">${d}</span>`,h.appendChild(m),h.scrollTop=h.scrollHeight,y.textContent=P()}function A(t){const e=t;m&&(m.innerHTML=`<span class="terminal-prompt">${P()}</span> $ ${e}`,m=null),R(e.trim())}o.addEventListener("click",()=>u.focus());function F(){var V,b;const t=["help","ls","cd","cat","yes","strfry","fortune"],e=L(d),r=/\s$/.test(d);if(e.length===0){n(t.join("  ")),n(""),a();return}const s=e.length===1&&!r;let i=r?"":e[e.length-1];if(s){const f=t.filter(_=>_.startsWith(i));f.length===1?(d=f[0]+" ",a()):f.length>1&&(n(f.join("  ")),n(""),a());return}const c=r?"":i;let w=p,D=c;const W=c.lastIndexOf("/");W>=0&&(w=c.slice(0,W)||"/",D=c.slice(W+1));const{node:g}=k(w||"/"),E=M(g).map(f=>f.endsWith("/")?f.slice(0,-1):f).filter(f=>f.startsWith(D));if(E.length===1){const f=E[0],_=(w&&w!=="/"?w+"/":"")+f,Q=/\s/.test(_)?`"${_}"`:_,x=[...e];r||x.pop(),x.push(Q);const j=((V=g==null?void 0:g.children)==null?void 0:V[f])||((b=g==null?void 0:g.children)==null?void 0:b[`${f}/`])||null;d=x.join(" ")+((j==null?void 0:j.type)==="folder"?"/":" "),a()}else E.length>1&&(n(E.join("  ")),n(""),a())}function $(){l&&typeof l.stop=="function"&&l.stop(),l=null}function L(t){const e=[];let r="",s=null;for(let i=0;i<t.length;i++){const c=t[i];if(c==='"'||c==="'"){s===c?s=null:s?r+=c:s=c;continue}if(!s&&(c===" "||c==="	")){r.length&&(e.push(r),r="");continue}r+=c}return r.length&&e.push(r),e}async function R(t){if(!t){d="",a();return}const[e,...r]=L(t),i={help:B,yes:G,ls:S,cat:N,strfry:H,fortune:q,cd:z}[e];i?await i(r):n(`${e}: command not found`),d="",a()}function B(){n("Available commands:"),n("  help                   - show this help"),n("  ls [path]              - list directories (simple view)"),n("  cd <path>              - change directory (limited virtual dirs)"),n("  cat <path>             - print file contents"),n("  yes                    - print y repeatedly (Ctrl+C to stop)"),n("  strfry <word>          - shuffle letters"),n("  fortune                - print a random fortune"),n("")}function k(t){var c;let e=t;e==null||e===""||e==="."?e=p:e==="~"&&(e="/");const r=e.startsWith("/")?I(e):I(`${p}/${e}`),s=r.split("/").filter(Boolean);let i=C();for(const w of s){if(!i||i.type!=="folder"||!((c=i.children)!=null&&c[w]))return{node:null,full:r};i=i.children[w]}return{node:i,full:r}}function M(t){return!t||t.type!=="folder"?[]:Object.entries(t.children||{}).map(([e,r])=>r.type==="folder"?`${e}/`:e)}function S(t){const e=t[0]?t[0]:".",{node:r,full:s}=k(e);if(!r||r.type!=="folder")n(`ls: cannot access '${e}': No such file or directory`);else{const i=M(r);n(i.join("  "))}n("")}async function N(t){if(!t.length){n("cat: missing file operand"),n("");return}const e=t[0],{node:r,full:s}=k(e);if(!r){n(`cat: ${e}: No such file or directory`),n("");return}if(r.type==="folder"){n(`cat: ${e}: Is a directory`),n("");return}Z(r,s),n("")}function H(t){if(!t.length){n("strfry: missing operand"),n("");return}const r=t[0].split("");for(let s=r.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[r[s],r[i]]=[r[i],r[s]]}n(r.join("")),n("")}async function q(){try{const t=await fetch("/documents/fortunes.txt");if(!t.ok)throw new Error("missing fortune file");const r=(await t.text()).split("%").map(i=>i.trim()).filter(Boolean);if(!r.length)throw new Error("no fortunes");const s=r[Math.floor(Math.random()*r.length)];n(s)}catch{n("fortune: could not load fortunes")}n("")}function z(t){const e=t[0];if(!e||e==="~"){p="/",n(""),a();return}if(e===".."){if(p!=="/"){const i=p.split("/").filter(Boolean);i.pop(),p=i.length?"/"+i.join("/"):"/"}n(""),a();return}const{node:r,full:s}=k(e);r&&r.type==="folder"?(p=s,n("")):(n(`cd: no such file or directory: ${e}`),n("")),a()}function G(){$();let t=0;const e=setInterval(()=>{n("y"),t+=1,t>=100&&$()},10);l={stop:()=>{clearInterval(e),l=null}}}return u.addEventListener("keydown",t=>{if(t.key==="c"&&t.ctrlKey){t.preventDefault(),n("^C"),$(),d="",a();return}if(t.key==="Tab"){t.preventDefault(),F();return}if(t.key==="Enter"){t.preventDefault(),A(d);return}if(t.key==="Backspace"){t.preventDefault(),d=d.slice(0,-1),a();return}if(t.key.length===1){t.preventDefault(),d+=t.key,a();return}}),n("Welcome to mwaOS shell."),n("Type commands and press Enter."),n(""),J().then(t=>{T=t||C()}).finally(()=>{T=T||C(),a(),u.focus()}),K({title:"Terminal",body:o,width:720,height:420,icon:`<svg viewBox="0 0 32 32" class="w-8 h-8">
      <rect x="2" y="4" width="28" height="24" rx="3" fill="#0f172a" stroke="#8ec8ff" stroke-width="2"/>
      <path d="M8 10l5 6-5 6" stroke="#7ed957" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      <path d="M16 22h7" stroke="#8ec8ff" stroke-width="2" stroke-linecap="round"/>
    </svg>`})}async function J(){try{const o=await fetch("/content/items.json");if(!o.ok)throw new Error("fs load failed");const u={type:"folder",children:await o.json()};return window.__mwaFsTree=u,u}catch(o){return console.error("terminal fs load error",o),null}}function C(){return window.__mwaFsTree||fsTree||{type:"folder",children:{}}}function U(o){return o&&o.type&&o.type!=="folder"}function Y(o,h){const u=window.wm;if(!u)return;const y=h.split("/").filter(Boolean).pop()||"File",m={pdf:async()=>{const l=await v(()=>import("./pdfViewer-CQKmUUk0.js"),__vite__mapDeps([0,1,2]));u.openWindow(l.createPdfViewer({title:y,src:o.src}))},text:async()=>{const l=await v(()=>import("./articleViewer-B_uRCk4S.js"),__vite__mapDeps([3,1,2]));u.openWindow(l.createArticleViewer({title:y,content:o.content,images:o.images||[]}))},gallery:async()=>{const l=await v(()=>import("./galleryViewer-mokeSg_E.js"),__vite__mapDeps([4,1,2]));u.openWindow(l.createGalleryViewer({title:y,imagePath:o.imagePath}))},hardware:async()=>{const l=await v(()=>import("./circuitViewer-CjOeRHjr.js"),__vite__mapDeps([5,1,2,6]));u.openWindow(l.createCircuitViewer({title:y,graph:o.graph}))},software:async()=>{const l=await v(()=>import("./softwareVisualizer-8YnuHtBs.js"),__vite__mapDeps([7,1,2,6]));u.openWindow(l.createSoftwareVisualizer({title:y,graph:o.graph}))},links:async()=>{var l,p;(p=(l=o.links)==null?void 0:l[0])!=null&&p.href&&window.open(o.links[0].href,"_blank")}}[o.type];m?m():o.src&&window.open(o.src,"_blank")}function Z(o,h){U(o)&&Y(o,h)}export{rt as createTerminal};
